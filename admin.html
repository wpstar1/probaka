<!DOCTYPE html>
<html class="dark" lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>ë°°ë„ˆ ê´€ë¦¬ì - Baccarat AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet"/>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#FFD700",
            "background-dark": "#0D1B2A",
            "surface-dark": "#172A3A",
          },
        },
      },
    }
  </script>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
    }
  </style>
</head>
<body class="bg-background-dark text-white min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-primary mb-2">ë°°ë„ˆ ê´€ë¦¬ì</h1>
      <p class="text-gray-400">ì£¼ìš”ê¸°ëŠ¥ ì„¹ì…˜ ìœ„ì— í‘œì‹œë  ë°°ë„ˆë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
      <a href="index.html" class="inline-block mt-4 px-4 py-2 bg-surface-dark text-white rounded-lg hover:bg-surface-dark/80 transition">
        <span class="material-symbols-outlined text-sm align-middle">arrow_back</span>
        ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
      </a>
    </div>

    <!-- ë°°ë„ˆ ì„ íƒ íƒ­ -->
    <div class="bg-surface-dark rounded-xl p-4 mb-6">
      <div class="flex gap-3">
        <button id="tab-main-banner" class="flex-1 px-6 py-3 bg-primary text-black font-bold rounded-lg transition">
          ìƒë‹¨ ë°°ë„ˆ (ì£¼ìš”ê¸°ëŠ¥ ìœ„)
        </button>
        <button id="tab-pattern-banner" class="flex-1 px-6 py-3 bg-background-dark text-white font-bold rounded-lg hover:bg-primary hover:text-black transition">
          íŒ¨í„´ ë¶„ì„ê¸° ë°°ë„ˆ
        </button>
      </div>
    </div>

    <!-- ë°°ë„ˆ ì„¤ì • -->
    <div class="bg-surface-dark rounded-xl p-6 mb-6">
      <h2 class="text-xl font-bold text-primary mb-4" id="banner-title">ìƒë‹¨ ë°°ë„ˆ ì„¤ì • (ì£¼ìš”ê¸°ëŠ¥ ìœ„)</h2>

      <!-- ë°°ë„ˆ í™œì„±í™”/ë¹„í™œì„±í™” -->
      <div class="mb-6">
        <label class="flex items-center justify-between p-4 bg-background-dark rounded-lg cursor-pointer">
          <span class="text-white font-medium">ë°°ë„ˆ í™œì„±í™”</span>
          <div class="relative">
            <input type="checkbox" id="banner-active" class="sr-only peer">
            <div class="w-14 h-7 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-primary"></div>
          </div>
        </label>
      </div>

      <!-- ë°°ë„ˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
      <div class="mb-4">
        <label class="block text-white font-medium mb-2">
          ë°°ë„ˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ
          <span class="text-sm text-gray-400 font-normal ml-2">(JPG, PNG, GIF, WebP)</span>
        </label>
        <div class="flex flex-col gap-3">
          <label for="banner-image" class="flex items-center justify-center w-full h-32 px-4 py-6 bg-background-dark border-2 border-dashed border-gray-700 rounded-lg cursor-pointer hover:border-primary transition">
            <div class="flex flex-col items-center justify-center text-center">
              <span class="material-symbols-outlined text-4xl text-primary mb-2">cloud_upload</span>
              <p class="text-sm text-white">í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ ì„ íƒ</p>
              <p class="text-xs text-gray-500 mt-1">ë˜ëŠ” íŒŒì¼ì„ ë“œë˜ê·¸ ì•¤ ë“œë¡­</p>
            </div>
          </label>
          <input
            type="file"
            id="banner-image"
            accept="image/*"
            class="hidden"
          />
          <div id="image-info" class="hidden">
            <div class="flex items-center justify-between p-3 bg-background-dark border border-primary/30 rounded-lg">
              <div class="flex items-center gap-3">
                <span class="material-symbols-outlined text-primary">image</span>
                <div>
                  <p class="text-white text-sm font-medium" id="file-name">íŒŒì¼ëª….jpg</p>
                  <p class="text-gray-400 text-xs" id="file-size">0 KB</p>
                </div>
              </div>
              <button type="button" id="remove-image" class="text-red-500 hover:text-red-400 transition">
                <span class="material-symbols-outlined">close</span>
              </button>
            </div>
          </div>
        </div>
        <p class="text-xs text-gray-500 mt-2">ê¶Œì¥ í¬ê¸°: ìµœì†Œ 1200x200px (ë°˜ì‘í˜•ìœ¼ë¡œ ìë™ ì¡°ì •ë©ë‹ˆë‹¤)</p>
        <p class="text-xs text-green-500 mt-1">âœ… ì—…ë¡œë“œëœ ì´ë¯¸ì§€ëŠ” ìë™ìœ¼ë¡œ ìµœì í™”ë˜ì–´ ì••ì¶•ë©ë‹ˆë‹¤.</p>
        <p class="text-xs text-gray-400 mt-1">â€¢ ê°€ë¡œ í¬ê¸°ëŠ” ìµœëŒ€ 1200pxë¡œ ì¡°ì •ë©ë‹ˆë‹¤.</p>
        <p class="text-xs text-gray-400">â€¢ í’ˆì§ˆì€ 80%ë¡œ ì••ì¶•ë©ë‹ˆë‹¤ (í•„ìš”ì‹œ ìë™ìœ¼ë¡œ ë” ì••ì¶•).</p>
      </div>

      <!-- ë°°ë„ˆ ë§í¬ URL -->
      <div class="mb-4">
        <label class="block text-white font-medium mb-2">
          ë°°ë„ˆ í´ë¦­ ì‹œ ì´ë™í•  ë§í¬ URL
          <span class="text-sm text-gray-400 font-normal ml-2">(ì„ íƒì‚¬í•­)</span>
        </label>
        <input
          type="text"
          id="banner-link"
          placeholder="https://example.com"
          class="w-full px-4 py-3 bg-background-dark text-white border border-gray-700 rounded-lg focus:outline-none focus:border-primary"
        />
      </div>

      <!-- ìƒˆ íƒ­ì—ì„œ ì—´ê¸° ì˜µì…˜ -->
      <div class="mb-6">
        <label class="flex items-center p-4 bg-background-dark rounded-lg cursor-pointer">
          <input type="checkbox" id="banner-target-blank" class="w-5 h-5 text-primary bg-gray-700 border-gray-600 rounded focus:ring-primary focus:ring-2">
          <span class="ml-3 text-white">ìƒˆ íƒ­ì—ì„œ ë§í¬ ì—´ê¸°</span>
        </label>
      </div>

      <!-- ë°°ë„ˆ Alt í…ìŠ¤íŠ¸ -->
      <div class="mb-6">
        <label class="block text-white font-medium mb-2">
          ë°°ë„ˆ Alt í…ìŠ¤íŠ¸
          <span class="text-sm text-gray-400 font-normal ml-2">(SEO ë° ì ‘ê·¼ì„±)</span>
        </label>
        <input
          type="text"
          id="banner-alt"
          placeholder="ë°°ë„ˆ ì„¤ëª…"
          class="w-full px-4 py-3 bg-background-dark text-white border border-gray-700 rounded-lg focus:outline-none focus:border-primary"
        />
      </div>

      <!-- ì €ì¥ ë²„íŠ¼ -->
      <div class="flex flex-col gap-3">
        <div class="flex gap-3">
          <button
            id="save-banner"
            class="flex-1 px-6 py-3 bg-primary text-black font-bold rounded-lg hover:bg-primary/90 transition"
          >
            ì €ì¥í•˜ê¸°
          </button>
          <button
            id="delete-banner"
            class="px-6 py-3 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition"
          >
            ì‚­ì œ
          </button>
        </div>
        <button
          id="save-and-preview"
          class="w-full px-6 py-3 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2"
        >
          <span class="material-symbols-outlined">visibility</span>
          ì €ì¥í•˜ê³  ë©”ì¸ í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ê¸°
        </button>
      </div>
    </div>

    <!-- ë¯¸ë¦¬ë³´ê¸° -->
    <div class="bg-surface-dark rounded-xl p-6">
      <h2 class="text-xl font-bold text-primary mb-4">ë¯¸ë¦¬ë³´ê¸°</h2>
      <div id="banner-preview" class="bg-background-dark rounded-lg p-4 min-h-[200px] flex items-center justify-center">
        <p class="text-gray-500">ë°°ë„ˆ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ì—¬ê¸°ì— ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
      </div>
    </div>

    <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
    <div id="notification" class="fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-x-[400px] transition-transform duration-300 z-50">
    </div>
  </div>

  <script>
    // í˜„ì¬ ì„ íƒëœ ë°°ë„ˆ íƒ€ì… ('main' ë˜ëŠ” 'pattern')
    let currentBannerType = 'main';

    // í˜„ì¬ ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ë°ì´í„°
    let uploadedImageData = null;

    // ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg transform transition-transform duration-300 z-50 ${
        type === 'success' ? 'bg-green-600 text-white' : 'bg-red-600 text-white'
      }`;
      notification.style.transform = 'translateX(0)';

      setTimeout(() => {
        notification.style.transform = 'translateX(400px)';
      }, 3000);
    }

    // íŒŒì¼ í¬ê¸°ë¥¼ í¬ë§·íŒ…í•˜ëŠ” í•¨ìˆ˜
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    // ì´ë¯¸ì§€ ì••ì¶• ë° ë¦¬ì‚¬ì´ì¦ˆ í•¨ìˆ˜
    function compressImage(file, maxWidth = 1200, quality = 0.8) {
      return new Promise((resolve, reject) => {
        // ì´ë¯¸ì§€ íŒŒì¼ íƒ€ì… ì²´í¬
        if (!file.type.startsWith('image/')) {
          reject(new Error('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.'));
          return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
          const img = new Image();
          img.onload = function() {
            // Canvas ìƒì„±
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            // ì´ë¯¸ì§€ í¬ê¸° ê³„ì‚° (ê°€ë¡œ ìµœëŒ€ 1200pxë¡œ ì œí•œ)
            let width = img.width;
            let height = img.height;

            if (width > maxWidth) {
              height = (height * maxWidth) / width;
              width = maxWidth;
            }

            // Canvas í¬ê¸° ì„¤ì •
            canvas.width = width;
            canvas.height = height;

            // ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
            ctx.drawImage(img, 0, 0, width, height);

            // ì••ì¶•ëœ ì´ë¯¸ì§€ë¥¼ base64ë¡œ ë³€í™˜ (JPEG, í’ˆì§ˆ 80%)
            const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);

            console.log('ì›ë³¸ í¬ê¸°:', formatFileSize(file.size));
            console.log('ì••ì¶• í›„ í¬ê¸°:', formatFileSize(compressedDataUrl.length * 0.75)); // base64ëŠ” ì•½ 33% ë” í¼

            resolve(compressedDataUrl);
          };
          img.onerror = function() {
            reject(new Error('ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'));
          };
          img.src = e.target.result;
        };
        reader.onerror = function() {
          reject(new Error('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'));
        };
        reader.readAsDataURL(file);
      });
    }

    // ì´ë¯¸ì§€ íŒŒì¼ ì²˜ë¦¬
    async function handleImageUpload(file) {
      // íŒŒì¼ í¬ê¸° ì²´í¬ (20MB ì œí•œ - ì••ì¶• ì „)
      if (file.size > 20 * 1024 * 1024) {
        showNotification('íŒŒì¼ í¬ê¸°ëŠ” 20MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
        return;
      }

      // ì´ë¯¸ì§€ íŒŒì¼ íƒ€ì… ì²´í¬
      if (!file.type.startsWith('image/')) {
        showNotification('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
        return;
      }

      // íŒŒì¼ ì •ë³´ í‘œì‹œ
      document.getElementById('file-name').textContent = file.name;
      document.getElementById('file-size').textContent = formatFileSize(file.size);
      document.getElementById('image-info').classList.remove('hidden');

      try {
        // ë¡œë”© ì•Œë¦¼
        showNotification('ì´ë¯¸ì§€ë¥¼ ì••ì¶•í•˜ëŠ” ì¤‘...', 'success');

        // ì´ë¯¸ì§€ ì••ì¶• ë° ë¦¬ì‚¬ì´ì¦ˆ
        const compressedImage = await compressImage(file, 1200, 0.8);

        // ì••ì¶•ëœ ì´ë¯¸ì§€ í¬ê¸° í™•ì¸
        const compressedSize = compressedImage.length * 0.75; // base64 ë””ì½”ë”© í›„ ì‹¤ì œ í¬ê¸°

        // localStorage ì œí•œ ì²´í¬ (ì•½ 2MBë¡œ ì œí•œ)
        if (compressedSize > 2 * 1024 * 1024) {
          // ë” ë†’ì€ ì••ì¶•ë¥ ë¡œ ì¬ì‹œë„
          showNotification('ì´ë¯¸ì§€ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. ë” ì••ì¶•í•˜ëŠ” ì¤‘...', 'success');
          uploadedImageData = await compressImage(file, 1000, 0.6);
        } else {
          uploadedImageData = compressedImage;
        }

        // ì••ì¶• í›„ í¬ê¸° í‘œì‹œ
        const finalSize = uploadedImageData.length * 0.75;
        document.getElementById('file-size').textContent = formatFileSize(file.size) + ' â†’ ' + formatFileSize(finalSize);

        updatePreview();
        showNotification('ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
      } catch (error) {
        console.error('ì´ë¯¸ì§€ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
        showNotification(error.message, 'error');
      }
    }

    // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
    const uploadLabel = document.querySelector('label[for="banner-image"]');

    uploadLabel.addEventListener('dragover', (e) => {
      e.preventDefault();
      e.stopPropagation();
      uploadLabel.classList.add('border-primary');
    });

    uploadLabel.addEventListener('dragleave', (e) => {
      e.preventDefault();
      e.stopPropagation();
      uploadLabel.classList.remove('border-primary');
    });

    uploadLabel.addEventListener('drop', (e) => {
      e.preventDefault();
      e.stopPropagation();
      uploadLabel.classList.remove('border-primary');

      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleImageUpload(files[0]);
      }
    });

    // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
    document.getElementById('banner-image').addEventListener('change', function(e) {
      if (e.target.files && e.target.files[0]) {
        handleImageUpload(e.target.files[0]);
      }
    });

    // ì´ë¯¸ì§€ ì œê±°
    document.getElementById('remove-image').addEventListener('click', () => {
      uploadedImageData = null;
      document.getElementById('banner-image').value = '';
      document.getElementById('image-info').classList.add('hidden');
      updatePreview();
    });

    // í˜„ì¬ ë°°ë„ˆ íƒ€ì…ì— ë§ëŠ” localStorage í‚¤ ê°€ì ¸ì˜¤ê¸°
    function getBannerStorageKey() {
      return currentBannerType === 'main' ? 'bannerData' : 'patternBannerData';
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    function loadBannerData() {
      const storageKey = getBannerStorageKey();
      const bannerData = localStorage.getItem(storageKey);

      // í¼ ì´ˆê¸°í™”
      uploadedImageData = null;
      document.getElementById('banner-active').checked = false;
      document.getElementById('banner-link').value = '';
      document.getElementById('banner-target-blank').checked = false;
      document.getElementById('banner-alt').value = '';
      document.getElementById('banner-image').value = '';
      document.getElementById('image-info').classList.add('hidden');

      if (bannerData) {
        const data = JSON.parse(bannerData);
        document.getElementById('banner-active').checked = data.active || false;
        document.getElementById('banner-link').value = data.link || '';
        document.getElementById('banner-target-blank').checked = data.targetBlank || false;
        document.getElementById('banner-alt').value = data.alt || '';

        // ì €ì¥ëœ ì´ë¯¸ì§€ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë¶ˆëŸ¬ì˜¤ê¸°
        if (data.image) {
          uploadedImageData = data.image;
          // íŒŒì¼ ì •ë³´ í‘œì‹œ (íŒŒì¼ëª…ê³¼ í¬ê¸°ëŠ” ì €ì¥ëœ ì •ë³´ ì‚¬ìš©)
          if (data.fileName) {
            document.getElementById('file-name').textContent = data.fileName;
            document.getElementById('file-size').textContent = data.fileSize || 'ì•Œ ìˆ˜ ì—†ìŒ';
            document.getElementById('image-info').classList.remove('hidden');
          }
        }

        updatePreview();
      } else {
        updatePreview();
      }
    }

    // íƒ­ ì „í™˜ í•¨ìˆ˜
    function switchBannerType(type) {
      currentBannerType = type;

      // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
      const mainTab = document.getElementById('tab-main-banner');
      const patternTab = document.getElementById('tab-pattern-banner');

      if (type === 'main') {
        mainTab.className = 'flex-1 px-6 py-3 bg-primary text-black font-bold rounded-lg transition';
        patternTab.className = 'flex-1 px-6 py-3 bg-background-dark text-white font-bold rounded-lg hover:bg-primary hover:text-black transition';
        document.getElementById('banner-title').textContent = 'ìƒë‹¨ ë°°ë„ˆ ì„¤ì • (ì£¼ìš”ê¸°ëŠ¥ ìœ„)';
      } else {
        mainTab.className = 'flex-1 px-6 py-3 bg-background-dark text-white font-bold rounded-lg hover:bg-primary hover:text-black transition';
        patternTab.className = 'flex-1 px-6 py-3 bg-primary text-black font-bold rounded-lg transition';
        document.getElementById('banner-title').textContent = 'íŒ¨í„´ ë¶„ì„ê¸° ë°°ë„ˆ ì„¤ì •';
      }

      // í•´ë‹¹ ë°°ë„ˆ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
      loadBannerData();
    }

    // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    function updatePreview() {
      const linkUrl = document.getElementById('banner-link').value;
      const alt = document.getElementById('banner-alt').value;
      const preview = document.getElementById('banner-preview');

      if (uploadedImageData) {
        const imgElement = document.createElement('img');
        imgElement.src = uploadedImageData;
        imgElement.alt = alt || 'ë°°ë„ˆ';
        imgElement.className = 'w-full h-auto rounded-lg object-cover max-h-[300px]';
        imgElement.onerror = () => {
          preview.innerHTML = '<p class="text-red-500">ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
        };

        if (linkUrl) {
          const linkElement = document.createElement('a');
          linkElement.href = linkUrl;
          linkElement.target = document.getElementById('banner-target-blank').checked ? '_blank' : '_self';
          linkElement.appendChild(imgElement);
          linkElement.className = 'block hover:opacity-90 transition-opacity cursor-pointer';
          preview.innerHTML = '';
          preview.appendChild(linkElement);
        } else {
          preview.innerHTML = '';
          preview.appendChild(imgElement);
        }
      } else {
        preview.innerHTML = '<p class="text-gray-500">ë°°ë„ˆ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ì—¬ê¸°ì— ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>';
      }
    }

    // ë°°ë„ˆ ì €ì¥
    document.getElementById('save-banner').addEventListener('click', () => {
      const active = document.getElementById('banner-active').checked;

      if (!uploadedImageData && active) {
        showNotification('ë°°ë„ˆ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'error');
        return;
      }

      const bannerData = {
        active: active,
        image: uploadedImageData,
        link: document.getElementById('banner-link').value,
        targetBlank: document.getElementById('banner-target-blank').checked,
        alt: document.getElementById('banner-alt').value,
        fileName: document.getElementById('file-name').textContent,
        fileSize: document.getElementById('file-size').textContent,
      };

      const storageKey = getBannerStorageKey();
      const bannerName = currentBannerType === 'main' ? 'ìƒë‹¨ ë°°ë„ˆ' : 'íŒ¨í„´ ë¶„ì„ê¸° ë°°ë„ˆ';

      console.log('Saving ' + bannerName + ' data:', {
        storageKey: storageKey,
        active: bannerData.active,
        hasImage: !!bannerData.image,
        imageLength: bannerData.image ? bannerData.image.length : 0,
        link: bannerData.link,
        targetBlank: bannerData.targetBlank,
        alt: bannerData.alt
      });

      try {
        // localStorageì— ì €ì¥ ì‹œë„
        const jsonData = JSON.stringify(bannerData);
        const dataSize = jsonData.length * 0.75; // ì‹¤ì œ í¬ê¸° ì¶”ì •

        console.log('ì €ì¥í•  ë°ì´í„° í¬ê¸°:', formatFileSize(dataSize));
        console.log('í˜„ì¬ localStorage ì‚¬ìš©ëŸ‰:', formatFileSize(JSON.stringify(localStorage).length));

        localStorage.setItem(storageKey, jsonData);
        console.log(bannerName + ' data saved successfully to localStorage');
        console.log('Verification - Reading back:', localStorage.getItem(storageKey) ? 'Data exists' : 'No data');
        showNotification(bannerName + 'ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ë©”ì¸ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.');
      } catch (e) {
        console.error('Error saving banner:', e);
        if (e.name === 'QuotaExceededError') {
          showNotification('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì´ë¯¸ì§€ë¥¼ ë” ì‘ê²Œ ì—…ë¡œë“œí•˜ê±°ë‚˜ ë‹¤ë¥¸ ë°°ë„ˆë¥¼ ì‚­ì œí•´ì£¼ì„¸ìš”.', 'error');

          // í•´ê²° ë°©ë²• ì•ˆë‚´
          setTimeout(() => {
            alert('ğŸ’¡ í•´ê²° ë°©ë²•:\n\n1. ë” ì‘ì€ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”\n2. ë‹¤ë¥¸ ë°°ë„ˆë¥¼ ì‚­ì œí•˜ì—¬ ê³µê°„ì„ í™•ë³´í•˜ì„¸ìš”\n3. ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì‚­ì œí•˜ì„¸ìš”\n\nì´ë¯¸ì§€ëŠ” ìë™ìœ¼ë¡œ ì••ì¶•ë˜ì§€ë§Œ, localStorage ìš©ëŸ‰(ì•½ 5-10MB)ì—ëŠ” ì œí•œì´ ìˆìŠµë‹ˆë‹¤.');
          }, 1000);
        } else {
          showNotification('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.message, 'error');
        }
      }
    });

    // ì €ì¥í•˜ê³  ë©”ì¸ í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ê¸°
    document.getElementById('save-and-preview').addEventListener('click', () => {
      const active = document.getElementById('banner-active').checked;

      if (!uploadedImageData && active) {
        showNotification('ë°°ë„ˆ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'error');
        return;
      }

      const bannerData = {
        active: active,
        image: uploadedImageData,
        link: document.getElementById('banner-link').value,
        targetBlank: document.getElementById('banner-target-blank').checked,
        alt: document.getElementById('banner-alt').value,
        fileName: document.getElementById('file-name').textContent,
        fileSize: document.getElementById('file-size').textContent,
      };

      const storageKey = getBannerStorageKey();
      const bannerName = currentBannerType === 'main' ? 'ìƒë‹¨ ë°°ë„ˆ' : 'íŒ¨í„´ ë¶„ì„ê¸° ë°°ë„ˆ';

      try {
        // localStorageì— ì €ì¥ ì‹œë„
        const jsonData = JSON.stringify(bannerData);
        const dataSize = jsonData.length * 0.75; // ì‹¤ì œ í¬ê¸° ì¶”ì •

        console.log('ì €ì¥í•  ë°ì´í„° í¬ê¸°:', formatFileSize(dataSize));
        console.log('í˜„ì¬ localStorage ì‚¬ìš©ëŸ‰:', formatFileSize(JSON.stringify(localStorage).length));

        localStorage.setItem(storageKey, jsonData);
        console.log(bannerName + ' data saved successfully');
        showNotification(bannerName + 'ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...');

        // 1ì´ˆ í›„ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 1000);
      } catch (e) {
        console.error('Error saving banner:', e);
        if (e.name === 'QuotaExceededError') {
          showNotification('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì´ë¯¸ì§€ë¥¼ ë” ì‘ê²Œ ì—…ë¡œë“œí•˜ê±°ë‚˜ ë‹¤ë¥¸ ë°°ë„ˆë¥¼ ì‚­ì œí•´ì£¼ì„¸ìš”.', 'error');

          // í•´ê²° ë°©ë²• ì•ˆë‚´
          setTimeout(() => {
            alert('ğŸ’¡ í•´ê²° ë°©ë²•:\n\n1. ë” ì‘ì€ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”\n2. ë‹¤ë¥¸ ë°°ë„ˆë¥¼ ì‚­ì œí•˜ì—¬ ê³µê°„ì„ í™•ë³´í•˜ì„¸ìš”\n3. ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì‚­ì œí•˜ì„¸ìš”\n\nì´ë¯¸ì§€ëŠ” ìë™ìœ¼ë¡œ ì••ì¶•ë˜ì§€ë§Œ, localStorage ìš©ëŸ‰(ì•½ 5-10MB)ì—ëŠ” ì œí•œì´ ìˆìŠµë‹ˆë‹¤.');
          }, 1000);
        } else {
          showNotification('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.message, 'error');
        }
      }
    });

    // ë°°ë„ˆ ì‚­ì œ
    document.getElementById('delete-banner').addEventListener('click', () => {
      const storageKey = getBannerStorageKey();
      const bannerName = currentBannerType === 'main' ? 'ìƒë‹¨ ë°°ë„ˆ' : 'íŒ¨í„´ ë¶„ì„ê¸° ë°°ë„ˆ';

      if (confirm(bannerName + 'ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        localStorage.removeItem(storageKey);
        uploadedImageData = null;
        document.getElementById('banner-active').checked = false;
        document.getElementById('banner-image').value = '';
        document.getElementById('banner-link').value = '';
        document.getElementById('banner-target-blank').checked = false;
        document.getElementById('banner-alt').value = '';
        document.getElementById('image-info').classList.add('hidden');
        updatePreview();
        showNotification(bannerName + 'ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    });

    // ì…ë ¥ í•„ë“œ ë³€ê²½ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    document.getElementById('banner-link').addEventListener('input', updatePreview);
    document.getElementById('banner-target-blank').addEventListener('change', updatePreview);
    document.getElementById('banner-alt').addEventListener('input', updatePreview);

    // íƒ­ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.getElementById('tab-main-banner').addEventListener('click', () => {
      switchBannerType('main');
    });

    document.getElementById('tab-pattern-banner').addEventListener('click', () => {
      switchBannerType('pattern');
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    loadBannerData();
  </script>
</body>
</html>
